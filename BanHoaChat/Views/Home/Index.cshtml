@{
    ViewData["Title"] = "Trang Chủ";
}

<!-- CSS -->
<style>
    /* Banner Section Styles */
    .banner .carousel-item {
        height: 500px;
        background-size: cover;
        background-position: center;
    }

    .banner .carousel-caption {
        bottom: 100px;
        background: rgba(0, 0, 0, 0.6);
        padding: 30px;
        border-radius: 10px;
    }

        .banner .carousel-caption h1 {
            font-size: 3rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .banner .carousel-caption p {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
        }

    .banner .btn-primary {
        padding: 10px 25px;
        font-size: 1.1rem;
        font-weight: 500;
    }

    /* Featured Products Slider Styles */
    .featured-products {
        padding: 10px 0;
        background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
        position: relative;
        overflow: hidden;
    }

    .section-header {
        margin-bottom: 60px;
    }

        .section-header h2 {
            font-size: 2.8rem;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 1.2rem;
            position: relative;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

            .section-header h2::after {
                content: '';
                position: absolute;
                bottom: -12px;
                left: 50%;
                transform: translateX(-50%);
                width: 100px;
                height: 5px;
                background: linear-gradient(to right, #3b82f6, #60a5fa);
                border-radius: 3px;
            }

        .section-header p {
            color: #64748b;
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

    /* Slider Container */
    .products-slider-container {
        position: relative;
        padding: 0 10px;
        max-width: 1400px;
        margin: 0 auto;
    }

    .products-slider {
        display: flex;
        overflow: hidden;
        scroll-behavior: smooth;
    }

    .products-slider-track {
        display: flex;
        transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        will-change: transform;
    }

    .product-card {
        flex: 0 0 25%;
        padding: 0 20px;
        transition: all 0.4s ease;
        margin-bottom: 20px;
    }

        .product-card.entering {
            opacity: 0;
            transform: translateY(30px);
        }

        .product-card.entered {
            opacity: 1;
            transform: translateY(0);
        }

        .product-card.exiting {
            opacity: 0;
            transform: translateY(-30px);
        }

        .product-card .card {
            border: none;
            border-radius: 16px;
            overflow: hidden;
            background: #ffffff;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            height: 100%;
            position: relative;
        }

        .product-card:hover .card {
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
            transform: translateY(-8px);
        }

        .product-card .card-img-top {
            height: 220px;
            object-fit: cover;
            width: 100%;
            transition: transform 0.3s ease;
        }

        .product-card:hover .card-img-top {
            transform: scale(1.05);
        }

        .product-card .card-body {
            padding: .5rem;
            text-align: center;
        }

        .product-card .card-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.2rem;
            line-height: 1.4;
            min-height: 3rem;
        }

        .product-card .price {
            color: #dc2626;
            font-weight: 800;
            font-size: 1.4rem;
            margin-bottom: .2rem;
        }

            .product-card .price .old-price {
                color: #9ca3af;
                font-size: 1rem;
                text-decoration: line-through;
                margin-left: 10px;
            }

        .product-card .badge {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 20px;
            z-index: 1;
        }

        .product-card .btn-add-to-cart {
            background: linear-gradient(to right, #3b82f6, #60a5fa);
            border: none;
            padding: 0.7rem 1.5rem;
            font-weight: 600;
            font-size: 1rem;
            width: 100%;
            border-radius: 8px;
            transition: all 0.3s ease;
            color: #ffffff;
        }

            .product-card .btn-add-to-cart:hover {
                background: linear-gradient(to right, #2563eb, #3b82f6);
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
                transform: translateY(-2px);
            }

        .product-card .card-footer {
            padding: 0 1.8rem 1.8rem;
            background: transparent;
            border: none;
        }

    /* Slider Navigation */
    .slider-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 50px;
        height: 50px;
        background: #ffffff;
        border: none;
        border-radius: 50%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 10;
        transition: all 0.3s ease;
        font-size: 1.5rem;
        color: #3b82f6;
    }

        .slider-arrow:hover {
            background: #3b82f6;
            color: #ffffff;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            transform: translateY(-50%) scale(1.1);
        }

    .slider-prev {
        left: 10px;
    }

    .slider-next {
        right: 10px;
    }

    /* Why choose us section */
    .why-choose-us {
        background-color: #f8f9fa;
        padding: 10px 0 30px 0;
    }

        .why-choose-us .feature-box {
            background: white;
            padding: 30px;
            border-radius: 12px;
            height: 100%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }

            .why-choose-us .feature-box:hover {
                transform: translateY(-5px);
            }

            .why-choose-us .feature-box i {
                font-size: 2.5rem;
                color: #3b82f6;
                margin-bottom: 1.5rem;
            }

            .why-choose-us .feature-box h3 {
                font-size: 1.3rem;
                margin-bottom: 1rem;
                color: #1e293b;
            }

            .why-choose-us .feature-box p {
                color: #64748b;
            }

        .why-choose-us .character-img {
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            max-width: 100%;
            height: auto;
        }

    /* About section */
    .about {
        padding: 80px 0;
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    }

        .about h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1.5rem;
        }

        .about p {
            font-size: 1.1rem;
            color: #475569;
            line-height: 1.8;
        }

    /* Responsive styles */
    @@media (max-width: 1200px) {
        .product-card

    {
        flex: 0 0 33.333%;
        max-width: 33.333%;
    }

    }

    @@media (max-width: 992px) {
        .banner .carousel-item

    {
        height: 400px;
    }

    .banner .carousel-caption {
        bottom: 50px;
        padding: 20px;
    }

        .banner .carousel-caption h1 {
            font-size: 2.2rem;
        }

    .product-card {
        flex: 0 0 50%;
        max-width: 50%;
    }

    .products-slider-container {
        padding: 0 40px;
    }

    .section-header h2 {
        font-size: 2.4rem;
    }

    .section-header p {
        font-size: 1.2rem;
    }

    .why-choose-us .content-wrapper {
        flex-direction: column;
    }

    .why-choose-us .character-img {
        margin-bottom: 30px;
    }

    }

    @@media (max-width: 768px) {
        .section-header h2

    {
        font-size: 2rem;
    }

    .section-header p {
        font-size: 1.1rem;
    }

    .product-card {
        flex: 0 0 100%;
        max-width: 100%;
    }

    .products-slider-container {
        padding: 0 30px;
    }

    .why-choose-us, .featured-products, .about {
        padding: 60px 0;
    }

    .slider-arrow {
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
    }

    }

    @@media (max-width: 576px) {
        .banner .carousel-item

    {
        height: 300px;
    }

    .banner .carousel-caption {
        bottom: 20px;
        padding: 15px;
    }

        .banner .carousel-caption h1 {
            font-size: 1.8rem;
        }

        .banner .carousel-caption p {
            font-size: 1rem;
            margin-bottom: 1rem;
        }

    .products-slider-container {
        padding: 0 20px;
    }

    .product-card .card-img-top {
        height: 180px;
    }

    .product-card .card-title {
        font-size: 1.1rem;
    }

    .product-card .price {
        font-size: 1.2rem;
    }

    .slider-arrow {
        width: 35px;
        height: 35px;
        font-size: 1rem;
    }

    }
</style>

<!-- Banner Section -->
<section class="banner">
    <div id="carouselBanner" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="https://lab-cuongthinh.com.vn/admin/webroot/uploads/images/HOA-CHAT-DUOC-PHAN-CHIA-THEO-QUY-DINH.jpg" class="d-block w-100" alt="Banner Hóa Chất">
                <div class="carousel-caption d-none d-md-block">
                    <h1>Hóa Chất Công Nghiệp Chất Lượng</h1>
                    <p>Cung cấp hóa chất an toàn, đạt tiêu chuẩn cho mọi ngành công nghiệp</p>
                    <a href="#products" class="btn btn-primary">Khám phá sản phẩm</a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Products Slider -->
<section class="featured-products" id="products">
    <div class="container">
        <div class="section-header text-center">
            <h2>Sản Phẩm Nổi Bật</h2>
            <p class="lead">Những sản phẩm chất lượng cao được khách hàng ưa chuộng</p>
        </div>

        <div class="products-slider-container">
            <button class="slider-arrow slider-prev" aria-label="Previous">
                <i class="bi bi-chevron-left"></i>
            </button>

            <div class="products-slider">
                <div class="products-slider-track" id="products-slider-track">
                    <div class="text-center py-5 w-100">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>

            <button class="slider-arrow slider-next" aria-label="Next">
                <i class="bi bi-chevron-right"></i>
            </button>
        </div>

        <div class="text-center mt-5">
            <a href="/products" class="btn btn-outline-primary btn-lg">Xem Tất Cả Sản Phẩm</a>
        </div>
    </div>
</section>

<!-- Why Choose Us Section -->
<section class="why-choose-us">
    <div class="container">
        <div class="section-header text-center mb-5">
            <h2>Tại Sao Chọn Chúng Tôi</h2>
            <p class="lead">Những lý do bạn nên lựa chọn chúng tôi làm đối tác</p>
        </div>
        <div class="content-wrapper d-flex align-items-center">
            <img src="https://www.sochemvn.com/wp-content/uploads/2022/07/Power.jpg" alt="Nhân vật nâng tạ" class="character-img me-5" style="max-width: 400px">
            <div class="feature-boxes">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="feature-box">
                            <i class="bi bi-award"></i>
                            <h3>ĐỘI NGŨ CHUYÊN NGHIỆP</h3>
                            <p>Với đội ngũ kỹ sư, chuyên gia giàu kinh nghiệm trong lĩnh vực hóa chất công nghiệp, chúng tôi tự tin mang đến giải pháp tối ưu cho khách hàng.</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="feature-box">
                            <i class="bi bi-cash-stack"></i>
                            <h3>GIÁ CẢ CẠNH TRANH</h3>
                            <p>Nhờ hệ thống sản xuất và phân phối tối ưu, chúng tôi mang đến mức giá cạnh tranh nhất thị trường mà vẫn đảm bảo chất lượng.</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="feature-box">
                            <i class="bi bi-box"></i>
                            <h3>HỆ THỐNG KHO BÃI HIỆN ĐẠI</h3>
                            <p>Hệ thống kho bồn đạt chuẩn, đảm bảo chất lượng hóa chất trong quá trình lưu trữ và vận chuyển đến tay khách hàng.</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="feature-box">
                            <i class="bi bi-truck"></i>
                            <h3>GIAO HÀNG NHANH CHÓNG</h3>
                            <p>Đội xe vận chuyển chuyên dụng, đảm bảo giao hàng đúng hẹn, an toàn đến mọi địa điểm trên toàn quốc.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- About Section -->
<section class="about" id="about">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h2>Về SoChemVN</h2>
                <p>SoChemVN là nhà cung cấp hóa chất công nghiệp hàng đầu tại Việt Nam, với hơn 15 năm kinh nghiệm trong lĩnh vực sản xuất và phân phối hóa chất. Chúng tôi tự hào là đối tác tin cậy của nhiều doanh nghiệp lớn trong và ngoài nước.</p>
                <p>Với hệ thống nhà máy sản xuất hiện đại, đội ngũ chuyên gia giàu kinh nghiệm và quy trình kiểm soát chất lượng nghiêm ngặt, SoChemVN cam kết mang đến những sản phẩm chất lượng cao, an toàn và thân thiện với môi trường.</p>
                <a href="/about" class="btn btn-primary mt-3">Tìm hiểu thêm</a>
            </div>
            <div class="col-lg-6">
                <img src="https://www.sochemvn.com/wp-content/uploads/2022/07/about-us.jpg" alt="Về SoChemVN" class="img-fluid rounded shadow">
            </div>
        </div>
    </div>
</section>

<!-- Scripts -->
@section Scripts {
    <script>
        // Biến toàn cục
        let products = [];
        let currentPosition = 0;
        let isAnimating = false;
        let autoSlideInterval;

        // Hàm load sản phẩm
        async function loadTopViewedProducts() {
            try {
                const response = await fetch('/api/Products/TopViewed?count=12');
                products = await response.json();
                console.log('Dữ liệu API:', products); // Kiểm tra dữ liệu API

                if (products.length > 0) {
                    renderProducts();
                    startAutoSlide();

                    // Tăng view count
                    products.forEach(p => fetch(`/api/Products/${p.productId}/View`, { method: 'POST' }));
                } else {
                    showErrorUI();
                }
            } catch (error) {
                console.error('Lỗi khi tải sản phẩm:', error);
                showErrorUI();
            }
        }

        // Hàm render sản phẩm với hiệu ứng
        function renderProducts() {
            const sliderTrack = document.getElementById("products-slider-track");
            sliderTrack.innerHTML = '';

            // Hiển thị 4 sản phẩm
            for (let i = 0; i < 4; i++) {
                const product = products[(currentPosition + i) % products.length];
                const card = createProductCard(product);
                sliderTrack.appendChild(card);

                // Thêm hiệu ứng xuất hiện
                setTimeout(() => {
                    card.classList.remove('entering');
                    card.classList.add('entered');
                }, 50 * i);
            }
        }

        // Hàm tạo card sản phẩm
        function createProductCard(product) {
            console.log('Sản phẩm:', product); // Kiểm tra cấu trúc sản phẩm
            // Chuyển đổi và kiểm tra giá trị
            const price = Number.isFinite(parseFloat(product.price)) ? parseFloat(product.price) : 0;
            const discount = Number.isFinite(parseFloat(product.discount)) ? parseFloat(product.discount) : 0;
            const discountedPrice = price * (1 - discount / 100);

            const card = document.createElement('div');
            card.className = 'product-card entering';
            card.innerHTML = `
                <div class="card">
                    ${discount > 0 ? `<span class="badge bg-danger">Giảm ${discount}%</span>` : ''}
                    <img src="${product.imageUrl || '/images/default-product.jpg'}"
                         class="card-img-top"
                         alt="${product.name || 'Sản phẩm không tên'}"
                         loading="lazy">
                    <div class="card-body">
                        <h3 class="card-title">${product.name || 'Sản phẩm không tên'}</h3>
                        <p class="price">
                            ${Number.isFinite(discountedPrice) ? discountedPrice.toLocaleString("vi-VN") : 'Liên hệ'}₫
                            ${discount > 0 && Number.isFinite(price) ? `<span class="old-price">${price.toLocaleString("vi-VN")}₫</span>` : ''}
                        </p>
                        <p class="card-text">${product.shortDescription || 'Không có mô tả chi tiết'}</p>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-add-to-cart" onclick="addToCart(${product.productId || 0})">
                            <i class="bi bi-cart-plus me-2"></i>Thêm vào giỏ
                        </button>
                    </div>
                </div>`;
            return card;
        }

        // Hàm thêm vào giỏ hàng
        function addToCart(productId) {
            console.log(`Thêm sản phẩm ${productId} vào giỏ hàng`);
            // Thêm logic gửi yêu cầu API để thêm vào giỏ hàng nếu cần
            // fetch(`/api/Cart/Add/${productId}`, { method: 'POST' });
        }

        // Hàm chuyển slide tiếp theo
        function slideNext() {
            if (isAnimating || products.length === 0) return;

            isAnimating = true;
            const sliderTrack = document.getElementById("products-slider-track");
            const cards = Array.from(sliderTrack.querySelectorAll('.product-card'));

            // Thêm hiệu ứng biến mất cho card đầu tiên
            if (cards[0]) {
                cards[0].classList.remove('entered');
                cards[0].classList.add('exiting');
            }

            // Sau khi hiệu ứng biến mất hoàn tất
            setTimeout(() => {
                // Cập nhật vị trí hiện tại
                currentPosition = (currentPosition + 1) % products.length;

                // Xóa card đầu tiên
                if (cards[0]) cards[0].remove();

                // Thêm card mới vào cuối với hiệu ứng
                const newProduct = products[(currentPosition + 3) % products.length];
                const newCard = createProductCard(newProduct);
                sliderTrack.appendChild(newCard);

                // Kích hoạt hiệu ứng xuất hiện
                setTimeout(() => {
                    newCard.classList.remove('entering');
                    newCard.classList.add('entered');
                    isAnimating = false;
                }, 50);

            }, 300); // Thời gian phải khớp với CSS transition
        }

        // Hàm chuyển slide trước
        function slidePrev() {
            if (isAnimating || products.length === 0) return;

            isAnimating = true;
            const sliderTrack = document.getElementById("products-slider-track");
            const cards = Array.from(sliderTrack.querySelectorAll('.product-card'));

            // Thêm hiệu ứng biến mất cho card cuối cùng
            if (cards[cards.length - 1]) {
                cards[cards.length - 1].classList.remove('entered');
                cards[cards.length - 1].classList.add('exiting');
            }

            // Sau khi hiệu ứng biến mất hoàn tất
            setTimeout(() => {
                // Cập nhật vị trí hiện tại
                currentPosition = (currentPosition - 1 + products.length) % products.length;

                // Xóa card cuối cùng
                if (cards[cards.length - 1]) cards[cards.length - 1].remove();

                // Thêm card mới vào đầu với hiệu ứng
                const newProduct = products[(currentPosition) % products.length];
                const newCard = createProductCard(newProduct);
                sliderTrack.prepend(newCard);

                // Kích hoạt hiệu ứng xuất hiện
                setTimeout(() => {
                    newCard.classList.remove('entering');
                    newCard.classList.add('entered');
                    isAnimating = false;
                }, 50);

            }, 300); // Thời gian phải khớp với CSS transition
        }

        // Tự động chạy slider
        function startAutoSlide() {
            clearInterval(autoSlideInterval);
            autoSlideInterval = setInterval(slideNext, 3000);
        }

        // Hàm hiển thị lỗi
        function showErrorUI() {
            const sliderTrack = document.getElementById("products-slider-track");
            sliderTrack.innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="bi bi-exclamation-triangle fs-1 text-danger"></i>
                    <h4 class="mt-3">Lỗi khi tải sản phẩm</h4>
                    <button class="btn btn-outline-primary mt-2" onclick="loadTopViewedProducts()">
                        <i class="bi bi-arrow-repeat me-2"></i>Thử lại
                    </button>
                </div>`;
        }

        // Khởi tạo khi trang tải xong
        document.addEventListener('DOMContentLoaded', function() {
            loadTopViewedProducts();

            // Gán sự kiện nút next
            document.querySelector('.slider-next').addEventListener('click', () => {
                slideNext();
                startAutoSlide(); // Reset timer khi click manual
            });

            // Gán sự kiện nút prev
            document.querySelector('.slider-prev').addEventListener('click', () => {
                slidePrev();
                startAutoSlide(); // Reset timer khi click manual
            });
        });
    </script>
}